<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Thank You — <%= formatName(d.name) %></title>
  <%- include("includes/head") %>
  <meta name="robots" content="noindex,follow">

  <style>
    /* Print-friendly: hide chrome, center card */
    @media print {
      header, footer, .noprint { display: none !important; }
      body { background: #fff !important; }
      .print-wrap { margin: 0 !important; padding: 0 !important; }
      .thank-card { box-shadow: none !important; border: none !important; }
    }
  </style>
</head>
<body>
  <header class="topbar noprint">
    <%- include("includes/header") %>
  </header>

  <main class="container print-wrap">
    <section class="hero noprint" style="padding-top:32px;">
      <div class="pill">Thank You Card</div>
      <h1>Donation #<%= d.id %></h1>
      <p>Create a printable thank-you for this donor.</p>
      <div class="row" style="display:flex; gap:12px;">
        <a class="btn" href="/admin">Back to admin</a>
        <button class="btn btn-primary" onclick="window.print()">Print</button>
      </div>
    </section>

    <!-- The card itself -->
    <section style="display:flex; justify-content:center; margin-top:18px;">
      <article class="thank-card card" style="max-width:800px; width:100%; padding:32px;">
        <div class="pill">The Game With No Name</div>
        <h1 id="thankTitle" style="margin:10px 0 4px; font-family: 'brothers', sans-serif;">
          Thank you, 
          <span id="donorName"><%= formatName(d.name) %></span>!
        </h1>
        <p class="section-sub" style="margin:0 0 16px; color:var(--muted);">
          <%= new Date(d.created_at).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}) %>
        </p>

        <div class="row" style="display:flex; gap:16px; flex-wrap:wrap; align-items: stretch">
          <div class="card" style="flex:1 1 220px;">
            <h3 class="mb-1">Amount</h3>
            <p style="font-size:24px; margin:0;">$<%= Number(d.donation || 0).toFixed(2) %></p>
          </div>
          <div class="card" style="flex:3 1 320px;">
            <h3 class="mb-1">Message</h3>
            <p id="donorMessage" style="margin:0; white-space:pre-wrap;\"><%= (d.message || '—') %></p>
          </div>
        </div>

        <p id="thankMessage" style="margin-top:24px;">
          Your support helps us bring online multiplayer, more maps, modes, and polish to the fast-action western shooter!
        </p>
      </article>
    </section>

    <!-- Form to edit thank-you -->
    <section class="noprint" style="max-width:800px; margin:24px auto;">
      <form id="thankForm" class="form vstack" style="gap:12px;">
        <div class="field">
          <label for="newMessage" class="label">Thank You Message</label>
          <textarea id="newMessage" rows="4" class="input" style="width:100%;"><%= "Your support helps us bring online multiplayer, more maps, modes, and polish to the fast-action western shooter!" %></textarea>
        </div>

        <div class="field" style="display:flex; gap:12px; align-items:center;">
          <input type="checkbox" id="hideName">
          <label for="hideName">Hide donor name</label>
        </div>

        <div class="field" style="display:flex; gap:12px; align-items:center;">
          <input type="checkbox" id="hideMessage">
          <label for="hideMessage">Hide donor message</label>
        </div>

        <button type="submit" class="btn btn-primary">Update Preview</button>
      </form>
    </section>

    <section class="noprint" style="text-align:center; margin-top:18px;">
      <a class="btn btn-primary" href="/back">Back the project</a>
    </section>
  </main>

  <footer class="center mt-4 noprint" style="padding:24px; color:var(--muted);">
    <%- include("includes/footer") %>
  </footer>

  <script>
    // Format name (first name + initials of the rest)
    function formatNameJS(name) {
      if (!name || !name.trim()) return "Anonymous";
      const parts = name.trim().split(/\s+/);
      if (parts.length === 1) return parts[0];
      return parts[0] + " " + parts.slice(1).map(p => p[0].toUpperCase() + ".").join(" ");
    }

    document.getElementById("thankForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const msg = document.getElementById("newMessage").value.trim();
      const hideName = document.getElementById("hideName").checked;
      const hideMessage = document.getElementById("hideMessage").checked;

      // Update thank you text
      document.getElementById("thankMessage").textContent = msg || "—";

      // Hide or show donor name
      const nameSpan = document.getElementById("donorName");
      if (hideName) {
        nameSpan.textContent = "valued supporter";
      } else {
        nameSpan.textContent = formatNameJS("<%= d.name || '' %>");
      }

      // Hide or show donor message
      const donorMsg = document.getElementById("donorMessage");
      donorMsg.textContent = hideMessage ? "—" : "<%= (d.message || '—') %>";
    });
  </script>
</body>
</html>
