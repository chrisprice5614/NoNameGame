<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

<% 
    const BASE_URL = "https://thegamewithnoname.com";
    const url = `${BASE_URL}/blog/${post.slug}`;
    // Derive description from the first paragraph-ish text:
    const plain = String(post.html || '')
      .replace(/<style[\s\S]*?<\/style>/gi, ' ').replace(/<script[\s\S]*?<\/script>/gi, ' ').replace(/<[^>]+>/g, ' ').replace(/\s+/g, ' ').trim();
    const description = plain.length ? (plain.length > 180 ? (plain.slice(0, 180) + '…') : plain) : 'Updates from The Game With No Name.';
    const pageTitle = `${post.title} - The Game With No Name`;
    const image = post.hero ? (post.hero.startsWith('http') ? post.hero : `${BASE_URL}${post.hero}`) : `${BASE_URL}/img/og-default.jpg`;
    const publishedISO = new Date(post.created_at).toISOString();
  %>

  <title><%= pageTitle %></title>
  <link rel="canonical" href="<%= url %>"/>

  <!-- Primary Meta -->
  <meta name="title" content="<%= pageTitle %>">
  <meta name="description" content="<%- description %>">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="The Game With No Name">
  <meta property="og:url" content="<%= url %>">
  <meta property="og:title" content="<%= pageTitle %>">
  <meta property="og:description" content="<%- description %>">
  <meta property="og:image" content="<%= image %>">
  <meta property="og:image:alt" content="Blog hero image for <%= post.title %>">
  <meta property="article:published_time" content="<%= publishedISO %>">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="<%= url %>">
  <meta name="twitter:title" content="<%= pageTitle %>">
  <meta name="twitter:description" content="<%- description %>">
  <meta name="twitter:image" content="<%= image %>">

  <%- include("includes/head") %>
  <meta name="description" content="<%= post.title %>">
</head>
<body>
<header class="topbar"><%- include("includes/header") %></header>
<main class="container">
  <section class="hero" style="padding-top:24px;">
    <div class="pill">Blog</div>
    <h1><%= post.title %></h1>
    <p class="section-sub" style="color:var(--muted)"><%= new Date(post.created_at).toLocaleDateString() %></p>
  </section>

  <article class="card" style="padding:0; overflow:hidden;">
    <% if (post.hero) { %>
        <img src="<%= post.hero %>" alt="" style="width:100%; aspect-ratio:21/9; object-fit:cover; display:block;">
    <% } %>
    <div style="padding:20px;">
        <%- post.html %>
    </div>
    </article>


  <section class="mt-3">
    <a class="btn" href="/blog">← Back to blog</a>
  </section>
</main>
<footer class="center mt-4" style="padding:24px; color:var(--muted)"><%- include("includes/footer") %></footer>
</body>
</html>
